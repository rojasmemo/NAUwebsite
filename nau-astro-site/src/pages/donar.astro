---
// src/pages/donar.astro
import { sanityClient } from 'sanity:client';
import { paginaDonarQuery } from '../lib/sanity/queries.js';
import { resolveCtaLink } from '../lib/utils';
import MainLayout from '../layouts/MainLayout.astro';
import HeroBanner from '../components/HeroBanner.astro';
import SplitSection from '../components/SplitSection.astro';
import DonationCard from '../components/DonationCard.astro';
import SanityImage from '../components/SanityImage.astro';
import { Image } from 'astro:assets';

// Import local assets that are not from Sanity
import decorativeImage from '../assets/images/2-DONA.webp';
import cardIcon from '../assets/images/CLIP-ENCUENTROS.webp';

// Fetch data from Sanity
const data = await sanityClient.fetch(paginaDonarQuery);

if (!data) {
  return new Response(null, {
    status: 404,
    statusText: 'No encontrado'
  });
}

const {
  title,
  seoDescription,
  hero1,
  introduction,
  donationSection,
  splitSection,
  hero2
} = data;

const hero2CtaLink = resolveCtaLink(hero2?.cta);
---

<MainLayout
  title={title}
  description={seoDescription}
>
  <main>
    <!-- Hero 1: Fetched from Sanity -->
    {hero1?.image && (
      <HeroBanner
        image={hero1.image}
        alt={hero1.alt || hero1.heading}
        bgColorClass="bg-custom-medium-teal"
        loading="eager"
        containerClasses="pt-16 pb-24 sm:pt-20 sm:pb-32 md:pt-24 md:pb-40 lg:pt-28 lg:pb-48 xl:pt-32 xl:pb-56 2xl:pt-36 2xl:pb-64 mb-4 md:mb-16 lg:mb-22"
      >
        <h2 class="h2-base md:mb-4">{hero1.heading}</h2>
        <p class="p-base-hero max-w-2xl lg:max-w-3xl xl:max-w-4xl mx-auto">
          {hero1.subheading}
        </p>
        <!-- Local Static Image -->
        <Image
          slot="decoration"
          src={decorativeImage}
          alt="Imagen decorativa de donación"
          class="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2 w-16 md:w-24 lg:w-32 xl:w-40 h-auto"
          loading="lazy"
        />
      </HeroBanner>
    )}

    <!-- Introduction: Fetched from Sanity -->
    <section class="content-section-wrapper py-10 md:py-16 bg-white px-4 sm:px-6 md:px-8 lg:px-16 xl:px-24 2xl:px-32">
      <div class="text-center">
        <p class="p-base max-w-3xl mx-auto text-left">
          {introduction}
        </p>
      </div>
    </section>

    <!-- Donation Section: Fetched from Sanity -->
    <section class="content-section-wrapper py-12 md:py-16 px-4 sm:px-6 md:px-8 lg:px-16 xl:px-24 2xl:px-32 bg-custom-specific-blue">
      <div class="text-center">
        <h2 class="h2-base text-white mb-12 md:mb-16">{donationSection.heading}</h2>
        <div class="grid md:grid-cols-2 gap-12 md:gap-8 lg:gap-10 xl:gap-12 mb-8">
          <!-- Donation Card 1 -->
          {donationSection.donationCard1 && (
            <DonationCard icon={cardIcon} iconAlt="Icono de donación online">
              <p class="p-base text-left mt-4 md:mt-16 mb-3">{donationSection.donationCard1.text}</p>
              <a href={donationSection.donationCard1.buttonUrl} target="_blank" rel="noopener noreferrer" class="inline-block bg-custom-light-teal text-custom-darker-teal font-semibold py-2 px-6 rounded-md hover:bg-opacity-80 hover:text-custom-dark-teal transition duration-300 mt-1">
                {donationSection.donationCard1.buttonText}
              </a>
            </DonationCard>
          )}
          <!-- Donation Card 2 -->
          {donationSection.donationCard2 && (
            <DonationCard icon={cardIcon} iconAlt="Icono de transferencia bancaria">
              <p class="p-base mt-4 md:mt-8 mb-3">{donationSection.donationCard2.text}</p>
              <ul class="p-base list-disc list-outside text-custom-darker-teal text-left pl-4 md:pl-12">
                {donationSection.donationCard2.bankDetails.map((item: string) => <li>{item}</li>)}
              </ul>
            </DonationCard>
          )}
        </div>
        <p class="p-base text-white mt-4 md:mt-8 mb-3">
          {donationSection.footerText}
        </p>
      </div>
    </section>

    <!-- Split Section: Fetched from Sanity -->
    {splitSection?.image && (
      <SplitSection
        bgColorClass="bg-custom-pale-teal"
        reverseOnMobile={true}
        gridColsClass="md:grid-cols-5"
        leftColClass="md:col-span-3"
        rightColClass="md:col-span-2"
      >
        <div slot="left" class="p-4 flex flex-col justify-center">
          <h3 class="h3-base text-custom-specific-blue text-left">
            <strong class="font-semibold">{splitSection.heading}</strong>
          </h3>
        </div>
        <div slot="right" class="px-6 md:px-0 flex justify-center items-center">
          <SanityImage
            image={splitSection.image}
            alt={splitSection.image.alt || 'Imagen de agradecimiento'}
            class="-mt-12 md:-mt-14 lg:-mt-16 xl:-mt-20 w-full max-w-xs h-auto object-contain rounded-lg mx-auto relative z-10"
            sizes="(max-width: 767px) 90vw, 320px"
          />
        </div>
      </SplitSection>
    )}

    <!-- Hero 2: Fetched from Sanity -->
    {hero2?.image && (
      <HeroBanner 
        image={hero2.image} 
        alt={hero2.alt || hero2.heading} 
        bgColorClass="bg-custom-medium-teal" 
        containerClasses="py-12 md:py-16 lg:py-20 xl:py-24 2xl:py-28"
      >
        <h2 class="h2-base max-w-2xl mx-auto">{hero2.heading}</h2>
        <p class="p-base-hero max-w-2xl lg:max-w-3xl xl:max-w-4xl mx-auto">{hero2.subheading}</p>
        {hero2.cta?.text && (
          hero2CtaLink ? (
            <a href={hero2CtaLink} class="inline-block bg-custom-light-teal text-custom-darker-teal font-semibold py-2 px-6 rounded-md hover:bg-opacity-80 hover:text-custom-dark-teal transition duration-300">
              {hero2.cta.text}
            </a>
          ) : (
            <span class="btn btn-disabled">{hero2.cta.text}</span>
          )
        )}
      </HeroBanner>
    )}
  </main>
</MainLayout>

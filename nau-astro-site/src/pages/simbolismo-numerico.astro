---
import MainLayout from '../layouts/MainLayout.astro';
import HeroBanner from '../components/HeroBanner.astro';
import SimbolismoNumericoCard from '../components/SimbolismoNumericoCard.astro';
import { sanityClient } from 'sanity:client';
import { paginaSimbolismoNumericoQuery } from '../lib/sanity/queries';
import { resolveCtaLink } from '../lib/utils';

// Importamos los nuevos componentes
import BannerWithCards from '../components/BannerWithCards.astro';
import RichTextSection from '../components/RichTextSection.astro';

// Fetch data from Sanity
const data = await sanityClient.fetch(paginaSimbolismoNumericoQuery);
const { page, servicios } = data;

const ctaBannerCtaLink = resolveCtaLink(page?.ctaBanner?.cta);

// Import a local icon since it's the same for all cards
import cardIcon from '../assets/images/CLIP-NUM.webp';
---

<MainLayout
  title={page?.title || 'Simbolismo Numérico - NAU'}
  description={page?.seoDescription || 'Descubre los servicios de NAU: Análisis de Simbolismo Numérico para ayudarte a conectar con tu esencia y propósito.'}
>
  <main>
    <!-- Main Banner Section -->
    {page?.mainBanner && (
      <HeroBanner
        image={page.mainBanner.image}
        alt={page.mainBanner.alt || 'Banner principal de Simbolismo Numérico'}
        bgColorClass="bg-custom-medium-teal"
        loading="eager"
        containerClasses="py-20 md:py-24 lg:py-28 xl:py-32 2xl:py-40"
      >
        <h2 class="h2-base md:mb-4">{page.mainBanner.heading}</h2>
        {page.mainBanner.tagline && (
          <p class="p-base-hero max-w-2xl mx-auto">
            {page.mainBanner.tagline}
          </p>
        )}
      </HeroBanner>
    )}

    <!-- 1. Intro Section (Pale Teal) -->
    {page?.introSection?.body && (
      <RichTextSection
        content={page.introSection.body}
        backgroundColor="bg-custom-pale-teal"
        textColor="text-custom-specific-blue"
      />
    )}

    <!-- 2. Banner with 3 Cards -->
    {page?.bannerWithCards && (
      <BannerWithCards
        title={page.bannerWithCards.title}
        backgroundImage={page.bannerWithCards.backgroundImage}
        cards={page.bannerWithCards.cards}
        bottomIcon={page.bannerWithCards.bottomIcon}
      />
    )}

    <!-- 3. Detailed Section (White) -->
    {page?.detailedSection?.body && (
      <RichTextSection
        title={page.detailedSection.title}
        content={page.detailedSection.body}
        backgroundColor="bg-white"
        textColor="text-custom-specific-blue"
      />
    )}

    <!-- 4. Final Section (replaces old introduction) -->
    {page?.finalSection?.body && (
      <RichTextSection
        title={page.finalSection.title}
        content={page.finalSection.body}
        backgroundColor="bg-custom-pale-teal"
        textColor="text-custom-specific-blue"
      />
    )}

    <!-- Services Section -->
    <section class="relative content-section-wrapper z-10 pt-12 md:pt-16 pb-4 md:pb-6 px-4 md:px-16 rounded-t-lg md:rounded-t-xl">
      <div class="grid md:grid-cols-2 gap-y-12 gap-x-8 md:gap-y-16 md:gap-x-10 mb-8 px-4 md:px-6 lg:px-20">
        {servicios?.map(servicio => (
          <SimbolismoNumericoCard 
            title={servicio.title}
            icon={cardIcon}
            image={servicio.image}
            imageAlt={servicio.alt}
            description={servicio.description}
          />
        ))}
      </div>
    </section>

    <!-- CTA Banner Section -->
    {page?.ctaBanner && (
      <HeroBanner 
        image={page.ctaBanner.image}
        alt={page.ctaBanner.alt || 'Banner de llamada a la acción'}
        bgColorClass="bg-custom-medium-teal" 
        containerClasses="py-12 md:py-20 lg:py-28 xl:py-32 2xl:py-44"
      >
        <p class="p-base-hero max-w-2xl mx-auto">{page.ctaBanner.tagline}</p>
        <h2 class="h2-base max-w-2xl mx-auto">{page.ctaBanner.heading}</h2>
        {page.ctaBanner.cta?.text && (
          ctaBannerCtaLink ? (
            <a href={ctaBannerCtaLink} class="btn btn-tertiary mt-4">{page.ctaBanner.cta.text}</a>
          ) : (
            <span class="btn btn-tertiary btn-disabled mt-4">{page.ctaBanner.cta.text}</span>
          )
        )}
      </HeroBanner>
    )}
  </main>
</MainLayout>
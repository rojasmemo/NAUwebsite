---
// src/pages/sobre-nau.astro
import MainLayout from '../layouts/MainLayout.astro';
import HeroBanner from '../components/HeroBanner.astro';
import { Image } from 'astro:assets';
import BannerWithCards from '../components/BannerWithCards.astro';
import { sanityClient } from 'sanity:client';
import { paginaSobreNauQuery } from '../lib/sanity/queries.js';
import SanityImage from '../components/SanityImage.astro';
import { resolveCtaLink } from '../lib/utils';

// Importamos los iconos estáticos
import decorativeIcon from '../assets/images/2-SOBRE-NAU-WEB.webp';
import purposeIcon from '../assets/images/4-SOBRE-NAU-WEB.webp';
import cardIcon1 from '../assets/images/SOBRE-NAU-CON-COSTO.webp';
import cardIcon2 from '../assets/images/SOBRE-NAU-DONACIONES.webp';
import cardIcon3 from '../assets/images/SOBRE-NAU-PADRINOS.webp';

const data = await sanityClient.fetch(paginaSobreNauQuery);

if (!data) {
  return new Response("Página no encontrada", { status: 404 });
}

const heroBanner1CtaLink = resolveCtaLink(data.heroBanner1.cta);
const contentSection2CtaLink = resolveCtaLink(data.contentSection2.cta);
const heroBanner2CtaLink = resolveCtaLink(data.heroBanner2.cta);
---

<MainLayout
  title={data.title}
  description={data.seoDescription}
>
  <main>
    <!-- Sección Hero 1: "Bienvenid@ a NAU." -->
    <HeroBanner
      image={data.heroBanner1.heroImage1}
      alt="Paisaje inspirador que representa un nuevo comienzo."
      bgColorClass="bg-custom-dark-teal"
      loading="eager"
      containerClasses="py-12 md:py-24 lg:py-28 xl:py-32 2xl:py-48 mb-4 md:mb-16 lg:mb-22"
    >
      <h2 class="h2-base md:mb-4">{data.heroBanner1.title}</h2>
      <p class="p-base-hero max-w-2xl mx-auto">
        {data.heroBanner1.mainText}
      </p>
      <p class="p-base-hero font-semibold max-w-2xl mx-auto">
        {data.heroBanner1.secondaryText}
      </p>
      {data.heroBanner1.cta?.text && (
        heroBanner1CtaLink ? (
          <a href={heroBanner1CtaLink} class="btn btn-primary mt-8">{data.heroBanner1.cta.text}</a>
        ) : (
          <span class="btn btn-primary btn-disabled mt-8">{data.heroBanner1.cta.text}</span>
        )
      )}

      <!-- Imagen decorativa posicionada en la parte inferior -->
      <Image
        slot="decoration"
        src={decorativeIcon}
        alt="Imagen decorativa Sobre NAU"
        class="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2 w-16 md:w-28 lg:w-40 h-auto"
        loading="lazy"
        widths={[64, 112, 160]}
        sizes="(max-width: 767px) 64px, (max-width: 1023px) 112px, 160px"
      />
    </HeroBanner>

    <!-- Sección de Contenido 1: "¿Por qué existimos?" -->
    <section class="content-section-wrapper py-10 md:py-16 bg-white px-8 sm:px-10 md:px-16 lg:px-20 xl:px-24 2xl:px-28">
      <div class="text-center">
        <h2 class="h2-base text-custom-specific-blue">
          {data.contentSection1.title}
        </h2>
        <h3 class="h3-base max-w-3xl mx-auto text-custom-darker-teal text-left md:text-center">
          {data.contentSection1.subtitle}
        </h3>
        {data.contentSection1.paragraphs.map((paragraph) => (
          <p class="p-base max-w-3xl mx-auto text-left">
            {paragraph}
          </p>
        ))}
      </div>
    </section>

    <!-- Sección de Contenido 2: "¿Qué hacemos y cómo?" -->
    <section class="content-section-wrapper py-10 md:py-16 px-4 sm:px-6 md:px-8 lg:px-16 xl:px-24 2xl:px-32 bg-custom-pale-teal">
      <div class="grid lg:grid-cols-5 gap-8 items-center">
        <div class="p-4 rounded-lg flex flex-col justify-center order-2 md:order-1 md:col-span-3">
          <h2 class="h2-base text-custom-darker-teal">
            {data.contentSection2.title}
          </h2>
          <h3 class="h3-base text-custom-darker-teal text-left">
            {data.contentSection2.subtitle}
          </h3>
          {data.contentSection2.paragraphs.map((paragraph) => (
            <p class="p-base text-left md:mb-8">
              {paragraph}
            </p>
          ))}
          {data.contentSection2.cta?.text && (
            contentSection2CtaLink ? (
              <a href={contentSection2CtaLink} class="btn btn-primary self-center">{data.contentSection2.cta.text}</a>
            ) : (
              <span class="btn btn-primary btn-disabled self-center">{data.contentSection2.cta.text}</span>
            )
          )}
        </div>
        <div class="rounded-lg overflow-hidden flex justify-center items-center order-1 md:order-2 md:col-span-2 px-6 md:px-0">
          <SanityImage image={data.contentSection2.contentImage} alt="Personas trabajando en equipo conectando con su esencia" class="w-full max-w-xs h-auto object-contain rounded-lg" widths={[320, 400]} sizes="(max-width: 767px) 90vw, 320px" />
        </div>
      </div>
    </section>

    <!-- Banner con Tarjetas: "¿Cómo lo hacemos?" -->
    <BannerWithCards
      title={data.bannerWithCards.title}
      subtitle={data.bannerWithCards.subtitle}
      backgroundImage={data.bannerWithCards.backgroundImage}
      cards={data.bannerWithCards.cards.map((card, index) => ({
        icon: [cardIcon1, cardIcon2, cardIcon3][index],
        iconAlt: 'Icono de contribución',
        description: card.description
      }))}
      bottomText={data.bannerWithCards.bottomText}
    />

    <!-- Sección de Contenido 3: "Nuestro Propósito" -->
    <section class="content-section-wrapper py-10 md:py-16 bg-white px-8 sm:px-10 md:px-16 lg:px-20 xl:px-24 2xl:px-28">
      <div class="text-center">
        <Image src={purposeIcon} alt="Icono representativo de NAU" class="block mx-auto w-24 md:w-28 lg:w-32 xl:w-36 h-auto mb-8" loading="lazy" widths={[96, 144]} sizes="(max-width: 767px) 96px, 144px" />
        <h2 class="h2-base text-custom-specific-blue">
          {data.contentSection3.title}
        </h2>
        <h3 class="h3-base max-w-3xl mx-auto text-custom-darker-teal text-left md:text-center">
          {data.contentSection3.subtitle}
        </h3>
        {data.contentSection3.paragraphs.map((paragraph) => (
        <p class="p-base max-w-3xl mx-auto text-left">
          {paragraph}
        </p>
        ))}
      </div>
    </section>

    <!-- Sección Hero 2: "Empecemos el camino, a tu manera." -->
    <HeroBanner
      image={data.heroBanner2.heroImage2}
      alt="Un camino que se abre paso en un paisaje natural, simbolizando el inicio de un viaje."
      bgColorClass="bg-custom-medium-teal"
      containerClasses="py-12 md:py-16 lg:py-24 xl:py-28 2xl:py-40"
    >
      <h2 class="h2-base">
        {data.heroBanner2.title}
      </h2>
      <p class="p-base-hero max-w-2xl mx-auto">
        {data.heroBanner2.mainText}
      </p>
      <p class="p-base-hero max-w-3xl mx-auto md:mb-4">
        {data.heroBanner2.additionalText}
      </p>
      {data.heroBanner2.cta?.text && (
        heroBanner2CtaLink ? (
          <a href={heroBanner2CtaLink} class="btn btn-tertiary">{data.heroBanner2.cta.text}</a>
        ) : (
          <span class="btn btn-tertiary btn-disabled">{data.heroBanner2.cta.text}</span>
        )
      )}
    </HeroBanner>
  </main>
</MainLayout>

<style>
  .content-section-wrapper p.p-base:not(:last-of-type) {
    margin-bottom: 1.5rem;
  }
</style>
---
// src/components/SanityImage.astro
import { sanityClient } from 'sanity:client';
import imageUrlBuilder from '@sanity/image-url';
import type { Image as SanityImage } from 'sanity';

// Recreamos el constructor de URLs de imágenes aquí
const builder = imageUrlBuilder(sanityClient);
function urlForImage(source: SanityImage) {
  return builder.image(source);
}

interface Props {
  image: SanityImage;
  class?: string;
  width?: number; // Ancho para la optimización de la URL
}

const { image, class: className, width = 800 } = Astro.props;
const dimensions = image?.asset?.metadata?.dimensions;

// No renderizar nada si la imagen o su asset no existen.
if (!image?.asset) {
  return null;
}

// Construimos la URL de la imagen con las optimizaciones deseadas.
const src = urlForImage(image).width(width).auto('format').url();
const alt = image.alt || 'Imagen descriptiva de NAU'; // Fallback por si el alt no está definido
---
<img
  src={src}
  alt={alt}
  loading="lazy"
  decoding="async"
  width={dimensions?.width}
  height={dimensions?.height}
  class:list={["w-full h-auto rounded-lg shadow-lg object-cover", className]}
/>
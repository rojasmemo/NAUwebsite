---
import { sanityClient } from 'sanity:client';
import { homePageQuery } from '../lib/sanity/queries';
import { resolveCtaLink } from '../lib/utils';
import MainLayout from '../layouts/MainLayout.astro';
import HeroBanner from '../components/HeroBanner.astro';
import SplitSection from '../components/SplitSection.astro';
import FeatureCard from '../components/FeatureCard.astro';
import SanityImage from '../components/SanityImage.astro';

const data = await sanityClient.fetch(homePageQuery);
console.log('Datos recibidos para la p√°gina de inicio:', JSON.stringify(data, null, 2));

// Fallback por si no hay datos
if (!data) {
  return new Response(null, {
    status: 404,
    statusText: 'No encontrado'
  });
}

const { 
  title,
  seoDescription,
  hero1,
  splitSection1,
  hero2,
  featureSection,
  splitSection2,
  hero3
} = data;

const hero1CtaLink = resolveCtaLink(hero1?.cta);
const hero2CtaLink = resolveCtaLink(hero2?.cta);
const hero3CtaLink = resolveCtaLink(hero3?.cta);
---

<MainLayout title={title} description={seoDescription}>

  <!-- Hero 1 -->
  {hero1?.image?.url && (
  <HeroBanner 
    image={hero1.image.url}
    alt={hero1.alt || hero1.heading}
    width={hero1.image.width}
    height={hero1.image.height}
    bgColorClass="bg-custom-dark-teal"
    loading="eager"
  >
    <h2 class="h2-base">{hero1.heading}</h2>
    <p class="p-base-hero max-w-2xl mx-auto">{hero1.subheading1}</p>
    <p class="p-base-hero max-w-2xl mx-auto md:mb-4">{hero1.subheading2}</p>
    {hero1.button?.text && (
      hero1CtaLink ? (
        <a href={hero1CtaLink} class="btn btn-primary">{hero1.button.text}</a>
      ) : (
        <span class="btn btn-primary btn-disabled">{hero1.button.text}</span>
      )
    )}
  </HeroBanner>
  )}

  <!-- Split Section 1 -->
  <SplitSection reverseOnMobile={true}>
    <div slot="left" class="bg-white p-4 md:py-8 rounded-lg flex flex-col justify-center">
      <div class="max-w-lg mx-auto">
        <h2 class="h2-base text-custom-dark-teal">{splitSection1.heading}</h2>
        <p class="p-base text-left">{splitSection1.paragraph1}</p>
        <p class="p-base text-left">{splitSection1.paragraph2}</p>
        <h3 class="h3-base text-custom-dark-teal text-center md:text-left">{splitSection1.subheading}</h3>
      </div>
    </div>
    {splitSection1?.image && (
    <div slot="right" class="rounded-lg overflow-hidden flex justify-center items-center">
      <div class="max-w-xs">
        <SanityImage image={splitSection1.image} width={320} noShadow={true} />
      </div>
    </div>
    )}
  </SplitSection>

  <!-- Hero 2 -->
  {hero2?.image?.url && (
  <HeroBanner 
    image={hero2.image.url}
    alt={hero2.alt || hero2.heading}
    width={hero2.image.width}
    height={hero2.image.height}
    bgColorClass="bg-custom-dark-teal"
  >
    <h2 class="h2-base max-w-2xl mx-auto">{hero2.heading}</h2>
    <p class="p-base-hero max-w-2xl mx-auto">{hero2.subheading1}</p>
    <p class="p-base-hero max-w-2xl mx-auto md:mb-8">{hero2.subheading2}</p>
    {hero2.button?.text && (
      hero2CtaLink ? (
        <a href={hero2CtaLink} class="btn btn-secondary">{hero2.button.text}</a>
      ) : (
        <span class="btn btn-secondary btn-disabled">{hero2.button.text}</span>
      )
    )}
  </HeroBanner>
  )}

  <!-- Feature Section -->
  <section class="content-section-wrapper py-12 md:py-16 bg-custom-pale-teal">
    <div class="text-center">
      <h2 class="h2-base text-custom-darker-teal mb-12 md:mb-16">{featureSection.heading}</h2>
      <div class="grid md:grid-cols-2 gap-12 md:gap-8 mb-8 px-4 md:px-8 lg:px-24">
        {featureSection.feature1?.icon && (
        <FeatureCard
          icon={featureSection.feature1.icon} 
          iconAlt={featureSection.feature1.iconAlt}
          title={featureSection.feature1.title}
          link={featureSection.feature1.link}
        >
          <ul class="p-base list-disc list-outside text-custom-darker-teal text-left pl-4 md:pl-12 space-y-2">
            {featureSection.feature1.items.map(item => <li>{item}</li>)}
          </ul>
        </FeatureCard>
        )}
        {featureSection.feature2?.icon && (
        <FeatureCard
          icon={featureSection.feature2.icon}
          iconAlt={featureSection.feature2.iconAlt}
          title={featureSection.feature2.title}
          link={featureSection.feature2.link}
        >
          <ul class="p-base list-disc list-outside text-custom-darker-teal text-left pl-4 md:pl-12 space-y-2">
            {featureSection.feature2.items.map(item => <li>{item}</li>)}
          </ul>
        </FeatureCard>
        )}
      </div>
      <h3 class="h3-base text-custom-darker-teal">{featureSection.subheading}</h3>
    </div>
  </section>

  <!-- Split Section 2 -->
  <SplitSection bgColorClass="bg-white">
    {splitSection2?.image && (
    <div slot="left" class="rounded-lg overflow-hidden flex justify-center items-center">
      <div class="max-w-sm">
        <SanityImage image={splitSection2.image} width={400} noShadow={true} />
      </div>
    </div>
    )}
    <div slot="right" class="bg-white text-custom-darker-teal p-4 md:p-8 rounded-lg text-center md:text-left flex flex-col justify-center items-center md:items-start">
      <div class="max-w-lg mx-auto">
        <h2 class="h2-base text-custom-dark-teal">{splitSection2.heading}</h2>
        <p class="p-base text-left">{splitSection2.paragraph1}</p>
        <p class="p-base text-left mb-6">{splitSection2.paragraph2}</p>
        <h3 class="h3-base text-custom-dark-teal text-center md:text-left mb-0">{splitSection2.subheading}</h3>
      </div>
    </div>
  </SplitSection>

  <!-- Hero 3 -->
  {hero3?.image?.url && (
  <HeroBanner 
    image={hero3.image.url}
    alt={hero3.alt || hero3.heading}
    width={hero3.image.width}
    height={hero3.image.height}
    bgColorClass="bg-custom-medium-teal"
  >
    <p class="p-base-hero max-w-2xl mx-auto">{hero3.subheading1}</p>
    <h2 class="h2-base max-w-2xl mx-auto">{hero3.heading}</h2>
    {hero3.button?.text && (
      hero3CtaLink ? (
        <a href={hero3CtaLink} class="btn btn-secondary">{hero3.button.text}</a>
      ) : (
        <span class="btn btn-secondary btn-disabled">{hero3.button.text}</span>
      )
    )}
  </HeroBanner>
  )}

</MainLayout>
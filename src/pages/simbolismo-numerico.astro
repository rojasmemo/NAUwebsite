---
import MainLayout from '../layouts/MainLayout.astro';
import HeroBanner from '../components/HeroBanner.astro';
import SimbolismoNumericoCard from '../components/SimbolismoNumericoCard.astro';
import { sanityClient } from '../lib/sanity/client';
import { paginaSimbolismoNumericoQuery } from '../lib/sanity/queries';
import { PortableText } from 'astro-portabletext';
import SanityImage from '../components/SanityImage.astro';

// Fetch data from Sanity
const data = await sanityClient.fetch(paginaSimbolismoNumericoQuery);
const { page, servicios } = data;

// Import a local icon since it's the same for all cards
import cardIcon from '../assets/images/CLIP-NUM.webp';
---

<MainLayout
  title={page?.title || 'Simbolismo Numérico - NAU'}
  description={page?.seoDescription || 'Descubre los servicios de NAU: Análisis de Simbolismo Numérico para ayudarte a conectar con tu esencia y propósito.'}
>
  <main>
    <!-- Main Banner Section -->
    {page?.mainBanner && (
      <HeroBanner
        image={page.mainBanner.image.url}
        alt={page.mainBanner.alt || 'Banner principal de Simbolismo Numérico'}
        bgColorClass="bg-custom-medium-teal"
        loading="eager"
        containerClasses="py-20 md:py-24 lg:py-28 xl:py-36 2xl:py-44"
      >
        <h2 class="h2-base md:mb-4">{page.mainBanner.heading}</h2>
        <p class="p-base-hero max-w-2xl mx-auto">
          {page.mainBanner.subheading}
        </p>
      </HeroBanner>
    )}

    <!-- Introduction Section -->
    {page?.introduction && (
      <section class="content-section-wrapper pt-12 md:pt-16 pb-24 md:pb-32 px-8 md:px-16 bg-custom-pale-teal relative">
        <div class="text-left max-w-3xl mx-auto text-custom-specific-blue">
          <PortableText value={page.introduction} />
        </div>
      </section>
    )}

    <!-- Services Section -->
    <section class="relative content-section-wrapper z-10 -mt-20 md:-mt-28 pt-12 md:pt-16 pb-4 md:pb-6 px-4 md:px-16 rounded-t-lg md:rounded-t-xl">
      <div class="grid md:grid-cols-2 gap-y-12 gap-x-8 md:gap-y-16 md:gap-x-10 mb-8 px-4 md:px-6 lg:px-20">
        {servicios?.map(servicio => (
          <a href={`/simbolismo-numerico/${servicio.slug}`} class="block no-underline">
            <SimbolismoNumericoCard 
              title={servicio.title}
              icon={cardIcon}
            >
              <div class="p-base text-custom-darker-teal text-left md:mb-8">
                <PortableText value={servicio.description} />
              </div>
            </SimbolismoNumericoCard>
          </a>
        ))}
      </div>
    </section>

    <!-- CTA Banner Section -->
    {page?.ctaBanner && (
      <HeroBanner 
        image={page.ctaBanner.image.url}
        alt={page.ctaBanner.alt || 'Banner de llamada a la acción'}
        bgColorClass="bg-custom-medium-teal" 
        containerClasses="py-12 md:py-20 lg:py-28 xl:py-32 2xl:py-44"
      >
        <p class="p-base-hero max-w-2xl mx-auto">{page.ctaBanner.subheading}</p>
        <h2 class="h2-base max-w-2xl mx-auto">{page.ctaBanner.heading}</h2>
        {page.ctaBanner.cta?.internalLink ? (
          <a href={page.ctaBanner.cta.internalLink.slug} class="inline-block bg-custom-light-teal text-custom-darker-teal font-semibold py-2 px-6 rounded-md hover:bg-opacity-80 hover:text-custom-dark-teal transition duration-300">
            {page.ctaBanner.cta.text}
          </a>
        ) : page.ctaBanner.cta?.externalUrl && (
          <a href={page.ctaBanner.cta.externalUrl} target="_blank" rel="noopener noreferrer" class="inline-block bg-custom-light-teal text-custom-darker-teal font-semibold py-2 px-6 rounded-md hover:bg-opacity-80 hover:text-custom-dark-teal transition duration-300">
            {page.ctaBanner.cta.text}
          </a>
        )}
      </HeroBanner>
    )}
  </main>
</MainLayout>
